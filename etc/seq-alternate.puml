@startuml

Cron -> PublishScheduler : scheduleEvents
activate PublishScheduler
PublishScheduler -> Provider : sunEphemerisFor(today)
activate Provider
Provider -> Redis : get(date)
activate Redis
Provider <-- Redis : null
deactivate Redis
Provider ->x SunriseAPI : HTTP
Provider ->x SunriseAPI : HTTP
Provider ->x SunriseAPI : HTTP
PublishScheduler <-- Provider : error
deactivate Provider

PublishScheduler -> Provider : sunEphemerisFor(yesterday)
activate Provider
Provider -> Redis : get(date - 1)
activate Redis
Provider <-- Redis : Ephemeris
deactivate Redis
PublishScheduler <-- Provider : Ephemeris
deactivate Provider

loop for each Event
    create PublishTask
    PublishScheduler -> PublishTask : new
    PublishScheduler -> TaskScheduler : schedule(task)
end

Cron <-- PublishScheduler
deactivate PublishScheduler

@enduml

